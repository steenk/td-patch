/* td-patch v0.1.0, (c) 2015 Steen Klingberg. License: MIT */
"function"!=typeof define&&(define=function(r){module.exports=r()}),define(function(){function r(r){return"op"in r&&"path"in r&&(r.op.match(f)&&"value"in r||r.op.match(u)&&"from"in r||r.op.match("remove"))}function o(r,o){var e,n,t=!1;if("string"==typeof r&&(r=JSON.parse(r)),"object"==typeof r){if("string"==typeof o)e=o.split("/");else{if(!Array.isArray(o))return;e=o}return e.forEach(function(o){t||(o=o.replace("~1","/").replace("~0","~"),""===o?n=r:"undefined"==typeof n[o]?(t=!0,n=void 0):n=n[o])}),n}}function e(r,e,n){return o(r,e)==n}function n(r,e){if(void 0===o(r,e))return!1;var n=e.split("/"),t=n.pop(),i=o(r,n);if(delete i[t],Array.isArray(i)){var p=n.pop();o(r,n)[p]=i.filter(function(r){return void 0!==r})}return!0}function t(r,e,n){var t=e.split("/"),i=t.pop(),p=o(r,t);return void 0===p?!1:(p[i]=n,!0)}function i(r,e,n){var t=e.split("/"),i=t.pop(),p=o(r,t);return void 0===p?!1:(delete p[i],p[i]=n,!0)}function p(r,e,n){var t=c(o(r,n),0),i=e.split("/"),p=i.pop(),a=o(r,i);if(void 0===a)return!1;a[p]=t;var f=n.split("/"),u=f.pop(),l=o(r,f);return delete l[u],!0}function a(r,e,n){var t=c(o(r,n),0),i=e.split("/"),p=i.pop(),a=o(r,i);return void 0===a?!1:(a[p]=t,!0)}function c(r,o){if(o>256)return void console.error(new Error("Structure is too deep."));if(null===r)return null;if("object"!=typeof r)return r;var e,n,t=Object.prototype.toString.call(r);if("[object Date]"===t)return new Date(r);if(0===t.indexOf("[object HTML"))return r.cloneNode(!0);if(0===t.indexOf("[object SVG"))return r.cloneNode(!0);if("[object Array]"===t)n=[];else{if("[object Object]"!==t)return void 0;n={}}for(e in r)n[e]=c(r[e],o+1);return n}var f=/^test$|^add$|^replace$/,u=/^move$|copy$/;return function(o,f){if(Array.isArray(f)&&"object"==typeof o){var u=c(o,0),l=!1;return f.forEach(function(o){return l?void 0:r(o)?void("test"===o.op?e(u,o.path,o.value)||(console.error(new Error("Patch tested wrong.")),l=!0):"remove"===o.op?n(u,o.path)||(console.error(new Error("Error in remove operation.")),l=!0):"add"===o.op?t(u,o.path,o.value)||(console.error(new Error("Error in add operation.")),l=!0):"replace"===o.op?i(u,o.path,o.value)||(console.error(new Error("Error in replace operation.")),l=!0):"move"===o.op?p(u,o.path,o.from)||(console.error(new Error("Error in move operation.")),l=!0):"copy"===o.op&&(a(u,o.path,o.from)||(console.error(new Error("Erron in copy operation.")),l=!0))):(console.error(new Error("Patch is not valid.")),void(l=!0))}),l?void 0:u}}});